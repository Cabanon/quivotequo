{% import "components.njk" as c %}
{% extends "parent.njk" %}

{% block head %}
<script defer src='/bundle.js'/>
{% endblock %}

{% block main %}
<input id="search" oninput="filter()" type="search" placeholder="Cherchez une procÃ©dure"/>
<select id="theme" onchange="filter()" aria-label="Filtrer par sujet">
  <option selected value="">ðŸš« Pas de filtre</option>
  {% for theme in subjects | where('theme') | map('theme') | uniq %}
    <option>{{ theme }}</option>
  {% endfor %}
</select>
<div id="list">
  {% set sorted = procedures | where('status', 'ProcÃ©dure terminÃ©e') | sort('date') | reverse %}
  {% for procedure in sorted %}
    <article>
      {% set themes = subjects | where_in('code', procedure.subjects) | map('theme') | uniq %}
      <header>{% for theme in themes %}{{ theme }} {% endfor %}</header>
      <a href="/procedure/{{ procedure.reference }}">{{ procedure.title }}</a>
      <footer><small>{{ procedure.date | date }} | {{ procedure.status }}</small></footer>
    </article>
  {% endfor %}
</div>
{% endblock %}